<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modules &mdash; Cryptol 3.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=86f27845" />

  
  
        <script src="_static/jquery.js?v=8dae8fb0"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=4f6ddb47"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Foreign Function Interface" href="FFI.html" />
    <link rel="prev" title="Type Declarations" href="TypeDeclarations.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="RefMan.html" class="icon icon-home">
            Cryptol
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Cryptol Reference Manual</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="BasicSyntax.html">Basic Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="Expressions.html">Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="BasicTypes.html">Basic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="OverloadedOperations.html">Overloaded Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="TypeDeclarations.html">Type Declarations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#hierarchical-module-names">Hierarchical Module Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-imports">Module Imports</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#import-lists">Import Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hiding-imports">Hiding Imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#qualified-module-imports">Qualified Module Imports</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#private-blocks">Private Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nested-modules">Nested Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#implicit-imports">Implicit Imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#managing-module-names">Managing Module Names</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#parameterized-modules">Parameterized Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#interface-modules">Interface Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#importing-an-interface-module">Importing an Interface Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interface-constraints">Interface Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instantiating-a-parameterized-module">Instantiating a Parameterized Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anonymous-interface-modules">Anonymous Interface Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anonymous-instantiation-arguments">Anonymous Instantiation Arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anonymous-import-instantiations">Anonymous Import Instantiations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#passing-through-module-parameters">Passing Through Module Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instantiation-by-parametrizing-declarations">Instantiation by Parametrizing Declarations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FFI.html">Foreign Function Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Project.html">Project Files</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="RefMan.html">Cryptol</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="RefMan.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Modules</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Modules.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="modules">
<h1>Modules<a class="headerlink" href="#modules" title="Link to this heading"></a></h1>
<p>A <em>module</em> is used to group related definitions.  Each file may
contain at most one top-level module.</p>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="kr">type</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>

<span class="nf">f</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="nf">f</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">10</span>
</pre></div>
</div>
<p>Module names should avoid using two consecutive underscored, because
those are used to generate names for various anonymous modules.</p>
<section id="hierarchical-module-names">
<h2>Hierarchical Module Names<a class="headerlink" href="#hierarchical-module-names" title="Link to this heading"></a></h2>
<p>Modules may have either simple or <em>hierarchical</em> names.
Hierarchical names are constructed by gluing together ordinary
identifiers using the symbol <code class="docutils literal notranslate"><span class="pre">::</span></code>.</p>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">Hash</span><span class="ow">::</span><span class="kt">SHA256</span><span class="w"> </span><span class="kr">where</span>

<span class="nf">sha256</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">...</span>
</pre></div>
</div>
<p>The structure in the name may be used to group together related
modules. The Cryptol implementation uses the structure of the
name to locate the file containing the module definition.
For example, when searching for module <code class="docutils literal notranslate"><span class="pre">Hash::SHA256</span></code>, Cryptol
will look for a file named <code class="docutils literal notranslate"><span class="pre">SHA256.cry</span></code> in a directory called
<code class="docutils literal notranslate"><span class="pre">Hash</span></code>, contained in one of the directories specified by <code class="docutils literal notranslate"><span class="pre">CRYPTOLPATH</span></code>.</p>
</section>
<section id="module-imports">
<h2>Module Imports<a class="headerlink" href="#module-imports" title="Link to this heading"></a></h2>
<p>To use the definitions from one module in another module, we use
<code class="docutils literal notranslate"><span class="pre">import</span></code> declarations:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">module M</span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="c1">// Provide some definitions</span>
<span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="nf">f</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="nf">f</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">module N</span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="c1">// Uses definitions from `M`</span>
<span class="kr">module</span><span class="w"> </span><span class="nn">N</span><span class="w"> </span><span class="kr">where</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">M</span><span class="w">  </span><span class="c1">// import all definitions from `M`</span>

<span class="nf">g</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">f</span><span class="w">   </span><span class="c1">// `f` was imported from `M`</span>
</pre></div>
</div>
</div>
<section id="import-lists">
<h3>Import Lists<a class="headerlink" href="#import-lists" title="Link to this heading"></a></h3>
<p>Sometimes, we may want to import only some of the definitions
from a module.  To do so, we use an import declaration with
an <em>import list</em>.</p>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="nf">f</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x02</span>
<span class="nf">g</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x03</span>
<span class="nf">h</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x04</span>
</pre></div>
</div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">N</span><span class="w"> </span><span class="kr">where</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">M</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">)</span><span class="w">  </span><span class="c1">// Imports only `f` and `g`, but not `h`</span>

<span class="nf">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">g</span>
</pre></div>
</div>
<p>Using explicit import lists helps reduce name collisions.
It also tends to make code easier to understand,  because
it makes it easy to see the source of definitions.</p>
</section>
<section id="hiding-imports">
<h3>Hiding Imports<a class="headerlink" href="#hiding-imports" title="Link to this heading"></a></h3>
<p>Sometimes a module may provide many definitions, and we want to use
most of them but with a few exceptions (e.g., because those would
result to a name clash).   In such situations it is convenient
to use a <em>hiding</em> import:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">module M</span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="nf">f</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x02</span>
<span class="nf">g</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x03</span>
<span class="nf">h</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x04</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">module N</span><a class="headerlink" href="#id4" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">N</span><span class="w"> </span><span class="kr">where</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="k">hiding</span><span class="w"> </span><span class="p">(</span><span class="nf">h</span><span class="p">)</span><span class="w"> </span><span class="c1">// Import everything but `h`</span>

<span class="nf">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">g</span>
</pre></div>
</div>
</div>
</section>
<section id="qualified-module-imports">
<h3>Qualified Module Imports<a class="headerlink" href="#qualified-module-imports" title="Link to this heading"></a></h3>
<p>Another way to avoid name collisions is by using a
<em>qualified</em> import.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">module M</span><a class="headerlink" href="#id5" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="nf">f</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="nf">f</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">module N</span><a class="headerlink" href="#id6" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">N</span><span class="w"> </span><span class="kr">where</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">P</span>

<span class="nf">g</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">P</span><span class="ow">::</span><span class="n">f</span>
<span class="c1">// `f` was imported from `M`</span>
<span class="c1">// but when used it needs to be prefixed by the qualifier `P`</span>
</pre></div>
</div>
</div>
<p>Qualified imports make it possible to work with definitions
that happen to have the same name but are defined in different modules.</p>
<p>Qualified imports may be combined with import lists or hiding clauses:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Example</span><a class="headerlink" href="#id7" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="nn">A</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">         </span><span class="c1">// introduces B::f</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">X</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="n">hiding</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">  </span><span class="c1">// introduces everything but `f` from X</span>
<span class="w">                          </span><span class="c1">// using the prefix `X`</span>
</pre></div>
</div>
</div>
<p>It is also possible to use the same qualifier prefix for imports
from different modules.  For example:</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Example</span><a class="headerlink" href="#id8" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="nn">A</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">B</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">X</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">B</span>
</pre></div>
</div>
</div>
<p>Such declarations will introduces all definitions from <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">X</span></code>
but to use them, you would have to qualify using the prefix <code class="docutils literal notranslate"><span class="pre">B::</span></code>.</p>
</section>
</section>
<section id="private-blocks">
<h2>Private Blocks<a class="headerlink" href="#private-blocks" title="Link to this heading"></a></h2>
<p>In some cases, definitions in a module might use helper
functions that are not intended to be used outside the module.
It is good practice to place such declarations in <em>private blocks</em>:</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Private blocks</span><a class="headerlink" href="#id9" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="nf">f</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="nf">f</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x01</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">helper1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">helper2</span>

<span class="nf">private</span>

<span class="w">  </span><span class="n">helper1</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="w">  </span><span class="n">helper1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span>

<span class="w">  </span><span class="n">helper2</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="w">  </span><span class="n">helper2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">3</span>
</pre></div>
</div>
</div>
<p>The private block only needs to be indented if it might be followed by
additional public declarations.   If all remaining declarations are to be
private then no additional indentation is needed as the <code class="docutils literal notranslate"><span class="pre">private</span></code> block will
extend to the end of the module.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Private blocks</span><a class="headerlink" href="#id10" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="nf">f</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="nf">f</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x01</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">helper1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">helper2</span>

<span class="nf">private</span>

<span class="nf">helper1</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="nf">helper1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span>

<span class="nf">helper2</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="nf">helper2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">3</span>
</pre></div>
</div>
</div>
<p>The keyword <code class="docutils literal notranslate"><span class="pre">private</span></code> introduces a new layout scope, and all declarations
in the block are considered to be private to the module.  A single module
may contain multiple private blocks.  For example, the following module
is equivalent to the previous one:</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Private blocks</span><a class="headerlink" href="#id11" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="nf">f</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="nf">f</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x01</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">helper1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">helper2</span>

<span class="nf">private</span>
<span class="w">  </span><span class="n">helper1</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="w">  </span><span class="n">helper1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span>

<span class="nf">private</span>
<span class="w">  </span><span class="n">helper2</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="w">  </span><span class="n">helper2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">3</span>
</pre></div>
</div>
</div>
</section>
<section id="nested-modules">
<h2>Nested Modules<a class="headerlink" href="#nested-modules" title="Link to this heading"></a></h2>
<p>Module may be declared within other modules, using the <code class="docutils literal notranslate"><span class="pre">submodule</span></code> keword.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Declaring a nested module called N</span><a class="headerlink" href="#id12" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x02</span>

<span class="w">  </span><span class="n">submodule</span><span class="w"> </span><span class="kt">N</span><span class="w"> </span><span class="kr">where</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
</div>
<p>Submodules may refer to names in their enclosing scope.
Declarations in a sub-module will shadow names in the outer scope.</p>
<p>Declarations in a submodule may be imported with <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">submodule</span></code>,
which works just like an ordinary import except that <code class="docutils literal notranslate"><span class="pre">X</span></code> refers
to the name of a submodule.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Using declarations from a submodule.</span><a class="headerlink" href="#id13" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x02</span>

<span class="w">  </span><span class="n">submodule</span><span class="w"> </span><span class="kt">N</span><span class="w"> </span><span class="kr">where</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>

<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">submodule</span><span class="w"> </span><span class="kt">N</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="kt">P</span>

<span class="w">  </span><span class="n">z</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">P</span><span class="ow">::</span><span class="n">y</span>
</pre></div>
</div>
</div>
<p>Note that recursive definitions across modules are not allowed.
So, in the previous example, it would be an error if <code class="docutils literal notranslate"><span class="pre">y</span></code> was
to try to use <code class="docutils literal notranslate"><span class="pre">z</span></code> in its definition.</p>
<section id="implicit-imports">
<h3>Implicit Imports<a class="headerlink" href="#implicit-imports" title="Link to this heading"></a></h3>
<p>For convenience, we add an implicit qualified submodule import for
each locally defined submodules.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">Making use of the implicit import for a submodule.</span><a class="headerlink" href="#id14" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x02</span>

<span class="w">  </span><span class="n">submodule</span><span class="w"> </span><span class="kt">N</span><span class="w"> </span><span class="kr">where</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>

<span class="w">  </span><span class="n">z</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">N</span><span class="ow">::</span><span class="n">y</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">N::y</span></code> works in the previous example because Cryptol added
an implicit import <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">submodule</span> <span class="pre">N</span> <span class="pre">as</span> <span class="pre">N</span></code>.</p>
</section>
<section id="managing-module-names">
<h3>Managing Module Names<a class="headerlink" href="#managing-module-names" title="Link to this heading"></a></h3>
<p>The names of nested modules are managed by the module system just
like the name of any other declaration in Cryptol.  Thus, nested
modules may be declared in the public or private sections of their
containing module, and must be imported before they can be used.
Thus, to use a submodule defined in top-level module <code class="docutils literal notranslate"><span class="pre">A</span></code> into
another top-level module <code class="docutils literal notranslate"><span class="pre">B</span></code> requires two steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>First we need to import <code class="docutils literal notranslate"><span class="pre">A</span></code> to bring the name of the submodule in scope,</p></li>
<li><p>Then we need to import the submodule to bring the names defined in it in scope.</p></li>
</ol>
</div></blockquote>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">Using a nested module from a different top-level module.</span><a class="headerlink" href="#id15" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">A</span><span class="w"> </span><span class="kr">where</span>

<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mh">0x02</span>

<span class="w">  </span><span class="n">submodule</span><span class="w"> </span><span class="kt">N</span><span class="w"> </span><span class="kr">where</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>

<span class="kr">module</span><span class="w"> </span><span class="nn">B</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">A</span><span class="w">            </span><span class="c1">// Brings `N` in scope</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">submodule</span><span class="w"> </span><span class="kt">N</span><span class="w">  </span><span class="c1">// Brings `y` in scope</span>
<span class="w">  </span><span class="n">z</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="parameterized-modules">
<h2>Parameterized Modules<a class="headerlink" href="#parameterized-modules" title="Link to this heading"></a></h2>
<section id="interface-modules">
<h3>Interface Modules<a class="headerlink" href="#interface-modules" title="Link to this heading"></a></h3>
<p>An <em>interface module</em> describes the content of a module
without providing a concrete implementation.</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">An interface module.</span><a class="headerlink" href="#id16" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="nf">interface</span><span class="w"> </span><span class="kr">module</span><span class="w"> </span><span class="nn">I</span><span class="w"> </span><span class="kr">where</span>

<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="o">#</span><span class="w">      </span><span class="c1">// `n` is a numeric type</span>

<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="p">(</span><span class="kr">fin</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                  </span><span class="c1">// Assumptions about the declared numeric type</span>

<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w">         </span><span class="c1">// A declarations of a constant</span>
</pre></div>
</div>
</div>
<p>Like other modules, interface modules may be nested in
other modules:</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">A nested interface module</span><a class="headerlink" href="#id17" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="w">  </span><span class="n">interface</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="kr">where</span>

<span class="w">    </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="o">#</span><span class="w">      </span><span class="c1">// `n` is a numeric type</span>

<span class="w">    </span><span class="kr">type</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="p">(</span><span class="kr">fin</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                    </span><span class="c1">// Assumptions about the declared numeric type</span>

<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w">         </span><span class="c1">// A declarations of a constant</span>
</pre></div>
</div>
</div>
<p>Interface modules may contain <code class="docutils literal notranslate"><span class="pre">type</span></code> or <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">constraint</span></code> synonyms:</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">A nested interface module</span><a class="headerlink" href="#id18" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="nf">interface</span><span class="w"> </span><span class="kr">module</span><span class="w"> </span><span class="nn">I</span><span class="w"> </span><span class="kr">where</span>

<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="o">#</span><span class="w">      </span><span class="c1">// `n` is a numeric type</span>

<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="kt">W</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w">    </span><span class="c1">// A type synonym, available when the interface is imported</span>

<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="p">(</span><span class="kr">fin</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                  </span><span class="c1">// Assumptions about the declared numeric type</span>

<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">W</span><span class="w">           </span><span class="c1">// A declarations of a constant;  uses type synonym.</span>
</pre></div>
</div>
</div>
</section>
<section id="importing-an-interface-module">
<h3>Importing an Interface Module<a class="headerlink" href="#importing-an-interface-module" title="Link to this heading"></a></h3>
<p>A module may be parameterized by importing an interface,
instead of a concrete module</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">A parameterized module</span><a class="headerlink" href="#id19" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="c1">// The interface desribes the parmaeters</span>
<span class="nf">interface</span><span class="w"> </span><span class="kr">module</span><span class="w"> </span><span class="nn">I</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="o">#</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="p">(</span><span class="kr">fin</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>


<span class="c1">// This module is parameterized</span>
<span class="kr">module</span><span class="w"> </span><span class="nn">F</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">interface</span><span class="w"> </span><span class="kt">I</span>

<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</pre></div>
</div>
</div>
<p>To import a nested interface use <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">interface</span> <span class="pre">sumbodule</span> <span class="pre">I</span></code>
and make sure that <code class="docutils literal notranslate"><span class="pre">I</span></code> is in scope.</p>
<p>It is also possible to import multiple interface modules,
or the same interface module more than once. Each import
of an interface module maybe be linked to a different concrete
module, as described in <a class="reference internal" href="#instantiating-modules"><span class="std std-ref">Instantiating a Parameterized Module</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">Multiple interface parameters</span><a class="headerlink" href="#id20" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="nf">interface</span><span class="w"> </span><span class="kr">module</span><span class="w"> </span><span class="nn">I</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="o">#</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="p">(</span><span class="kr">fin</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>


<span class="kr">module</span><span class="w"> </span><span class="nn">F</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">interface</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="kt">I</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">interface</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="kt">J</span>

<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="kt">I</span><span class="ow">::</span><span class="n">n</span><span class="p">]</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">I</span><span class="ow">::</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>

<span class="w">  </span><span class="n">z</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="kt">J</span><span class="ow">::</span><span class="n">n</span><span class="p">]</span>
<span class="w">  </span><span class="n">z</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">J</span><span class="ow">::</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</pre></div>
</div>
</div>
<p>A parameterized module is also called a <em>functor</em>, in the tradition
of module parameterization in languages like Standard ML and OCaml.</p>
</section>
<section id="interface-constraints">
<h3>Interface Constraints<a class="headerlink" href="#interface-constraints" title="Link to this heading"></a></h3>
<p>When working with multiple interfaces, it is to useful
to be able to impose additional constraints on the
types imported from the interface.</p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">Adding constraints to interface parameters</span><a class="headerlink" href="#id21" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="nf">interface</span><span class="w"> </span><span class="kr">module</span><span class="w"> </span><span class="nn">I</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="o">#</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="p">(</span><span class="kr">fin</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>


<span class="kr">module</span><span class="w"> </span><span class="nn">F</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">interface</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="kt">I</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">interface</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="kt">J</span>

<span class="w">  </span><span class="n">interface</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="p">(</span><span class="kt">I</span><span class="ow">::</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kt">J</span><span class="ow">::</span><span class="n">n</span><span class="p">)</span>

<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="kt">I</span><span class="ow">::</span><span class="n">n</span><span class="p">]</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">I</span><span class="ow">::</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">J</span><span class="ow">::</span><span class="n">x</span>
</pre></div>
</div>
</div>
<p>In this example we impose the constraint that <code class="docutils literal notranslate"><span class="pre">n</span></code>
(the width of <code class="docutils literal notranslate"><span class="pre">x</span></code>) in both interfaces must be the
same.  Note that, of course, the two instantiations
may provide different values for <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
</section>
<section id="instantiating-a-parameterized-module">
<span id="instantiating-modules"></span><h3>Instantiating a Parameterized Module<a class="headerlink" href="#instantiating-a-parameterized-module" title="Link to this heading"></a></h3>
<p>To use a parameterized module we need to provide concrete
implementations for the interfaces that it uses, and provide
a name for the resulting module.  This is done as follows:</p>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">Instantiating a parameterized module using a single interface.</span><a class="headerlink" href="#id22" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="nf">interface</span><span class="w"> </span><span class="kr">module</span><span class="w"> </span><span class="nn">I</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="o">#</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="p">(</span><span class="kr">fin</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="kr">module</span><span class="w"> </span><span class="nn">F</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">interface</span><span class="w"> </span><span class="kt">I</span>

<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>

<span class="kr">module</span><span class="w"> </span><span class="nn">Impl</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">8</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">26</span>

<span class="kr">module</span><span class="w"> </span><span class="nn">MyF</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">Impl</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>Here we defined a new module called <code class="docutils literal notranslate"><span class="pre">MyF</span></code> which is
obtained by filling in module <code class="docutils literal notranslate"><span class="pre">Impl</span></code> for the interface
used by <code class="docutils literal notranslate"><span class="pre">F</span></code>.</p>
<p>If a module is parameterized my multiple interfaces
we need to provide an implementation module for each
interface, using a slight variation on the previous notation.</p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">Instantiating a parameterized module by name.</span><a class="headerlink" href="#id23" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="c1">// I is defined as above</span>

<span class="kr">module</span><span class="w"> </span><span class="nn">F</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">interface</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="kt">I</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">interface</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="kt">J</span>

<span class="w">  </span><span class="n">interface</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="p">(</span><span class="kt">I</span><span class="ow">::</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kt">J</span><span class="ow">::</span><span class="n">n</span><span class="p">)</span>

<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="kt">I</span><span class="ow">::</span><span class="n">n</span><span class="p">]</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">I</span><span class="ow">::</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">J</span><span class="ow">::</span><span class="n">x</span>

<span class="kr">module</span><span class="w"> </span><span class="nn">Impl1</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">8</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">26</span>

<span class="kr">module</span><span class="w"> </span><span class="nn">Impl2</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">8</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">30</span>

<span class="kr">module</span><span class="w"> </span><span class="nn">MyF</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Impl1</span><span class="p">,</span><span class="w"> </span><span class="kt">J</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Impl</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>Each interface import is identified by its name,
which is derived from the <code class="docutils literal notranslate"><span class="pre">as</span></code> clause on the
interface import.  If there is no <code class="docutils literal notranslate"><span class="pre">as</span></code> clause,
then the name of the parameter is derived from
the name of the interface itself.</p>
<p>Since interfaces are identified by name, the
order in which they are provided is not important.</p>
<p>Modules defined by instantiation may be nested,
just like any other module:</p>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">Nested module instantiation.</span><a class="headerlink" href="#id24" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">Somewhere</span><span class="w"> </span><span class="c1">// defines G</span>

<span class="w">  </span><span class="n">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="kt">G</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">submodule</span> <span class="pre">F</span></code> is defined
by instantiating some other parameterized
module <code class="docutils literal notranslate"><span class="pre">G</span></code>, presumably imported from <code class="docutils literal notranslate"><span class="pre">Somewhere</span></code>.
Note that in this case the argument to the instantiation
<code class="docutils literal notranslate"><span class="pre">I</span></code> is a top-level module, because it is not
preceded by the <code class="docutils literal notranslate"><span class="pre">submodule</span></code> keyword.</p>
<p>To pass a nested module as the argument of a function,
use <code class="docutils literal notranslate"><span class="pre">submodule</span> <span class="pre">I</span></code> like this:</p>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text">Nested module instantiation.</span><a class="headerlink" href="#id25" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">Somewhere</span><span class="w"> </span><span class="c1">// defines G and I</span>

<span class="w">  </span><span class="n">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="kt">G</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="anonymous-interface-modules">
<h3>Anonymous Interface Modules<a class="headerlink" href="#anonymous-interface-modules" title="Link to this heading"></a></h3>
<p>If we need to just parameterize a module by a couple of types/values,
it is quite cumbersome to have to define a whole separate interface module.
To make this more convenient we provide the following notation for defining
an anonymous interface and using it straight away:</p>
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text">Simple parameterized module.</span><a class="headerlink" href="#id26" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="w">  </span><span class="n">parameter</span>
<span class="w">    </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="o">#</span>
<span class="w">    </span><span class="kr">type</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="p">(</span><span class="kr">fin</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="w">  </span><span class="n">f</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
<span class="w">  </span><span class="n">f</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">parameter</span></code> block defines an interface module and uses it.
Note that the parameters may not use things defined in <code class="docutils literal notranslate"><span class="pre">M</span></code> as
the interface is declared outside of <code class="docutils literal notranslate"><span class="pre">M</span></code>.  The <code class="docutils literal notranslate"><span class="pre">parameter</span></code>
may contain the same sort of declarations that may appear in interfaces.</p>
<p>For external tools interacting with Cryptol, the name of the anonymous
parameter interface for module <code class="docutils literal notranslate"><span class="pre">M</span></code> is <code class="docutils literal notranslate"><span class="pre">M__parameter</span></code> (note that there
are 2 underscores after the name).</p>
</section>
<section id="anonymous-instantiation-arguments">
<h3>Anonymous Instantiation Arguments<a class="headerlink" href="#anonymous-instantiation-arguments" title="Link to this heading"></a></h3>
<p>Sometimes it is also a bit cumbersome to have to define a whole
separate module just to pass it as an argument to some parameterized
module.   To make this more convenient we support the following notation
for instantiating a module:</p>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="c1">// A parameterized module</span>
<span class="kr">module</span><span class="w"> </span><span class="nn">M</span><span class="w"> </span><span class="kr">where</span>

<span class="w">  </span><span class="n">parameter</span>
<span class="w">    </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="o">#</span>
<span class="w">    </span><span class="n">x</span><span class="w">      </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
<span class="w">    </span><span class="n">y</span><span class="w">      </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="w">  </span><span class="n">f</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
<span class="w">  </span><span class="n">f</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span>


<span class="c1">// A module instantiation</span>
<span class="kr">module</span><span class="w"> </span><span class="nn">N</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">M</span>
<span class="w">  </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">32</span>
<span class="w">  </span><span class="n">x</span><span class="w">      </span><span class="ow">=</span><span class="w"> </span><span class="mi">11</span>
<span class="w">  </span><span class="n">y</span><span class="w">      </span><span class="ow">=</span><span class="w"> </span><span class="n">helper</span>

<span class="w">  </span><span class="n">helper</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">12</span>
</pre></div>
</div>
<p>The declarations in the <code class="docutils literal notranslate"><span class="pre">where</span></code> block are treated as the
definition of an anonymous module which is passed as the argument
to parameterized module <code class="docutils literal notranslate"><span class="pre">M</span></code>.</p>
<p>For external tools interacting with Cryptol, the name of the anonymous
module actually passed to the functor is as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">N__where</span></code>, if <code class="docutils literal notranslate"><span class="pre">N</span></code> is a top-level module</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">where__at_l_c</span></code>, if <code class="docutils literal notranslate"><span class="pre">N</span></code> is a submodule</p></li>
</ul>
</div></blockquote>
<p>In the second form <code class="docutils literal notranslate"><span class="pre">l</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code> are the line and column of <code class="docutils literal notranslate"><span class="pre">N</span></code>.
If <code class="docutils literal notranslate"><span class="pre">c</span></code> is 1, then it is omitted, and the name will be just <code class="docutils literal notranslate"><span class="pre">where__at_l</span></code>.
Note that in both cases the anonymous name contains two underscores next
to each other.</p>
</section>
<section id="anonymous-import-instantiations">
<h3>Anonymous Import Instantiations<a class="headerlink" href="#anonymous-import-instantiations" title="Link to this heading"></a></h3>
<p>We provide syntactic sugar for importing and instantiating a functor
at the same time:</p>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="nf">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">parameter</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">where</span></code> block may is the same as the <code class="docutils literal notranslate"><span class="pre">where</span></code> block in
expressions:  you may define type synonyms and values, but nothing else
(e.g., no <code class="docutils literal notranslate"><span class="pre">newtype</span></code>).</p>
<p>It is also possible to import and instantiate a functor with an existing module
like this:</p>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="nf">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">parameter</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>

<span class="nf">submodule</span><span class="w"> </span><span class="kt">G</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">7</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="kt">G</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>Semantically, instantiating imports declare a local nested module and
import it.  For example, the <code class="docutils literal notranslate"><span class="pre">where</span></code> import above is equivalent
to the following declarations:</p>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="nf">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="kr">where</span>

<span class="w">  </span><span class="n">parameter</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>

<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>


<span class="nf">submodule</span><span class="w"> </span><span class="kt">M</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span>


<span class="nf">submodule</span><span class="w"> </span><span class="kt">N</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="kt">M</span><span class="w"> </span><span class="p">}</span>


<span class="kr">import</span><span class="w"> </span><span class="nn">submodule</span><span class="w"> </span><span class="kt">N</span>
</pre></div>
</div>
<p>For external tools interacting with Cryptol, the name of the anonymous
module used in the import (the <code class="docutils literal notranslate"><span class="pre">N</span></code> in the above example) is of the form
<code class="docutils literal notranslate"><span class="pre">import_at__l_c</span></code>, where <code class="docutils literal notranslate"><span class="pre">l</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code> are the line and column of the
<code class="docutils literal notranslate"><span class="pre">import</span></code> keyword.  If the column is 1, then it is omitted, and the name
is of the form <code class="docutils literal notranslate"><span class="pre">import_at__l</span></code>.  Note that the name contains two underscores
next to each other.</p>
</section>
<section id="passing-through-module-parameters">
<h3>Passing Through Module Parameters<a class="headerlink" href="#passing-through-module-parameters" title="Link to this heading"></a></h3>
<p>Occasionally it is useful to define a functor that instantiates <em>another</em>
functor using the same parameters as the functor being defined
(i.e., a functor parameter is passed on to another functor).  This can
be done by using the keyword <code class="docutils literal notranslate"><span class="pre">interface</span></code> followed by the name of a parameter
in an instantiation.  Here is an example:</p>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="nf">interface</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="kt">S</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>

<span class="c1">// A functor, parameterized on S</span>
<span class="nf">submodule</span><span class="w"> </span><span class="kt">G</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">interface</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="kt">S</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>

<span class="c1">// Another functor, also parameterize on S</span>
<span class="nf">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">interface</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="kt">S</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="kt">A</span>

<span class="w">  </span><span class="c1">// Instantiate `G` using parameter `A` of `F`</span>
<span class="w">  </span><span class="kr">import</span><span class="w"> </span><span class="nn">submodule</span><span class="w"> </span><span class="kt">G</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="p">}</span><span class="w">    </span><span class="c1">// Brings `y` in scope</span>

<span class="w">  </span><span class="n">z</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">A</span><span class="ow">::</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span>

<span class="c1">// Brings `z` into scope: z = A::x + y</span>
<span class="c1">//                          = 5    + (5 + 1)</span>
<span class="c1">//                          = 11</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">5</span>
</pre></div>
</div>
</section>
<section id="instantiation-by-parametrizing-declarations">
<h3>Instantiation by Parametrizing Declarations<a class="headerlink" href="#instantiation-by-parametrizing-declarations" title="Link to this heading"></a></h3>
<p>It is also possible to instantiate a functor parameter <em>without</em> providing
an implementation module.  Instead, the declarations in the instantiated
module all get additional parameters corresponding to the functor’s parameters.
This is done by providing <code class="docutils literal notranslate"><span class="pre">_</span></code> as the parameter to a functor:</p>
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text">Instantiation by Parametrizing Declarations</span><a class="headerlink" href="#id27" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="nf">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">parameter</span>
<span class="w">    </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="o">#</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="w">  </span><span class="n">f</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">(</span><span class="kr">fin</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
<span class="w">  </span><span class="n">f</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span>

<span class="nf">submodule</span><span class="w"> </span><span class="kt">M</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="p">}</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">submodule</span><span class="w"> </span><span class="kt">M</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="kt">M</span>
</pre></div>
</div>
</div>
<p>This example defines module <code class="docutils literal notranslate"><span class="pre">M</span></code> by instantiating <code class="docutils literal notranslate"><span class="pre">F</span></code> without
a parameter.  Here is the resulting type of <code class="docutils literal notranslate"><span class="pre">f</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Main</span><span class="o">&gt;</span> <span class="p">:</span><span class="n">t</span> <span class="n">M</span><span class="p">::</span><span class="n">f</span>
<span class="n">M</span><span class="p">::</span><span class="n">f</span> <span class="p">:</span> <span class="p">{</span><span class="n">n</span><span class="p">}</span> <span class="p">(</span><span class="n">fin</span> <span class="n">n</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="p">[</span><span class="n">n</span><span class="p">]}</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">n</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">f</span></code> has a new type parameter <code class="docutils literal notranslate"><span class="pre">n</span></code>, and a new value parameter
of a record type.  The type parameter <code class="docutils literal notranslate"><span class="pre">n</span></code> corresponds to the functor’s
type parameter while the record parameter has one field for each value
parameter of the functor.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The order in which type parameters are added to a declaration is not
specified, so you’d have to use a <em>named</em> type application to apply
a type explicitly.</p>
</div>
<p>Functors with multiple parameters may use <code class="docutils literal notranslate"><span class="pre">_</span></code> as argument for more
than one parameter, and may also provide implementations for some of
the parameters and use <code class="docutils literal notranslate"><span class="pre">_</span></code> for others.</p>
<p><strong>[Parameter Names]</strong> The names of the parameters in the declarations
are the same as the names that are in scope, unless a parameter came
in through a qualified interface import (i.e., the interface import
uses the <code class="docutils literal notranslate"><span class="pre">as</span></code> clause).  In the case the name of the parameter is
computed by replacing the <code class="docutils literal notranslate"><span class="pre">::</span></code> with <code class="docutils literal notranslate"><span class="pre">'</span></code> because <code class="docutils literal notranslate"><span class="pre">::</span></code> may not appear
in type parameters or record fields.  For example, if a module had
a parameter <code class="docutils literal notranslate"><span class="pre">I::x</span></code>, then its <code class="docutils literal notranslate"><span class="pre">_</span></code> instantiation will use a
record with a field named <code class="docutils literal notranslate"><span class="pre">I'x</span></code>.</p>
<p><strong>[Restrictions]</strong> There are some restrictions on functor parameters
that can be defined with <code class="docutils literal notranslate"><span class="pre">_</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p>The functor should not contain other functors nested in it.
This is because it is unclear how to parameterize the parameters of
nested functors.</p></li>
<li><p>All values coming through <code class="docutils literal notranslate"><span class="pre">_</span></code> parameters should have simple
(i.e., non-polymorphic) types.  This is because Cryptol does not
support records with polymorphic fields.</p></li>
<li><p>All types and values coming through <code class="docutils literal notranslate"><span class="pre">_</span></code> parameters should have
distinct names.  This is because the fields in the record and
type names use labels derived. Generally this should not be a
problem unless a functor defined some parameters that have
<code class="docutils literal notranslate"><span class="pre">'</span></code> in the middle.</p></li>
</ul>
</div></blockquote>
<p><strong>[Backtick Imports]</strong> For backward compatibility, we also provide
syntactic sugar for importing a functor with a single interface parameter
and instantiating it:</p>
<div class="literal-block-wrapper docutils container" id="id28">
<div class="code-block-caption"><span class="caption-text">Backtick Import</span><a class="headerlink" href="#id28" title="Link to this code"></a></div>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="nf">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">parameter</span>
<span class="w">    </span><span class="kr">type</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="o">#</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="w">  </span><span class="n">f</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">(</span><span class="kr">fin</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
<span class="w">  </span><span class="n">f</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">submodule</span><span class="w"> </span><span class="p">`</span><span class="kt">F</span>
</pre></div>
</div>
</div>
<p>This is equivalent to writing:</p>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="nn">submodule</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>This, in turn, is syntactic sugar for creating an anonymous module:</p>
<div class="highlight-cryptol notranslate"><div class="highlight"><pre><span></span><span class="nf">submodule</span><span class="w"> </span><span class="kt">M</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">F</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="p">}</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">submodule</span><span class="w"> </span><span class="kt">M</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="TypeDeclarations.html" class="btn btn-neutral float-left" title="Type Declarations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="FFI.html" class="btn btn-neutral float-right" title="Foreign Function Interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024: The Cryptol Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book">Doc version</span>
    v: 
    <span class="fa fa-caret-down"></span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
      </dl>
      <dl>
        <dt>Pull Requests</dt>
        
      </dl>
    </div>
  </span>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>